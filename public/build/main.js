"use strict";define("controllers/module",["angular"],function(e){return e.module("ontour.controllers",[])}),"use strict",define("controllers/AutocompleteController",["./module"],function(e){e.controller("AutocompleteController",["$scope","AutocompleteService",function(e,t){e.autocomplete={items:[]},e.selectItem=function(t){e.autocomplete.activeItem=t},e.getAutocompleteData=function(t){e.autocomplete.items=[],e.menu.activeTab.title=="artist"?e.getArtists(t):e.menu.activeTab.title=="location"&&e.getCities(t)},e.getArtists=function(n){t.getArtistsData(n).success(function(t){if(typeof t.results!="undefined"){var n=t.results.artistmatches.artist;typeof n!="undefined"&&n.length&&(e.autocomplete.items=n)}})},e.getCities=function(n){t.getCitiesData(n).success(function(t){t.length&&(e.autocomplete.items=[],t.length=5,t.forEach(function(t){var n=t.split(", ");e.autocomplete.items.push({name:n[0],meta:n[2]})}))})},e.$on("resetAutocomplete",function(){e.autocomplete.items=[]})}])}),"use strict",define("controllers/EventController",["./module"],function(e){e.controller("EventController",["$scope","$filter",function(e,t){e.$watchCollection("lastEvents",function(){e.lastEvents.length?(angular.forEach(e.lastEvents,function(n,r,i){e.addIcon(n),e.addMarker(n),n.date=t("date")(new Date(n.startDate),"mediumDate"),e.menu.activeTab.param!=="geo"&&i[r-1]&&n.marker!==undefined&&i[r-1].marker!==undefined&&e.setPaths(n,i[r-1]),e.addPopup(n)}),e.events=e.events.concat(e.lastEvents)):(e.events=[],e.resetCluster())}),e.addIcon=function(t){t.image[3]["#text"]&&(t.icon=L.icon({iconUrl:t.image[3]["#text"],iconSize:e.menu.activeTab.param=="geo"?[75,75]:[25,25],className:"dot"}))},e.addMarker=function(t){t.venue.location["geo:point"]["geo:lat"]&&t.venue.location["geo:point"]["geo:long"]&&t.icon&&(t.marker=L.marker([t.venue.location["geo:point"]["geo:lat"],t.venue.location["geo:point"]["geo:long"]],{icon:t.icon}),e.cluster.addLayer(t.marker))},e.setPaths=function(t,n){t.path=L.polyline([t.marker.getLatLng(),n.marker.getLatLng()],{color:"rgb(204,188,173)",weight:2,opacity:1}).addTo(e.map)},e.addPaths=function(){angular.forEach(e.events,function(t,n,r){t.path&&e.map.addLayer(t.path)})},e.removePaths=function(){angular.forEach(e.events,function(t,n,r){t.path&&e.map.removeLayer(t.path)})},e.$on("resetPaths",e.removePaths),e.addPopup=function(t){if(t.marker==null)return!1;t.selected=!1,t.popup=L.popup({autoPan:!1,closeButton:!1,offset:L.point(0,e.menu.activeTab.param=="geo"?-30:-5),closeOnClick:!1}).setLatLng(t.marker.getLatLng()).setContent('<div class="event-item"><img src="'+t.image[3]["#text"]+'" class="artist-pic" />'+'<div class="artist-data">'+t.date+"<br/>"+t.artists.headliner+"<br/><br/>"+t.venue.name+"<br/>"+t.venue.location.city+" "+t.venue.location.country+"</div></div>"),t.marker.on("mouseover",function(){e.showPopup(t,0)},t),t.marker.on("mouseout",function(){e.hidePopup(t)},t),t.marker.on("click",function(){e.selectEvent(t)},t)},e.selectEvent=function(t){t.popup!=null&&(t.selected?(e.hidePopup(t),t.selected=!1):(e.showPopup(t,1),t.selected=!0,e.$$phase||e.$apply()))},e.showPopup=function(t,n){t.popup!=null&&t.selected==0&&(e.map.addLayer(t.popup),t.focused=!0,n&&e.map.panTo(t.marker.getLatLng()),e.$$phase||e.$apply())},e.hidePopup=function(t){t.popup!=null&&t.selected==0&&(e.map.removeLayer(t.popup),t.focused=!1,e.$$phase||e.$apply())}}])}),"use strict",define("controllers/MapController",["./module","mapbox","cluster"],function(e){e.controller("MapController",["$scope",function(e){e.cluster=new L.MarkerClusterGroup,e.map=L.mapbox.map("map","examples.map-i87786ca",{minZoom:2,maxZoom:14}),e.map.setView([0,0],2).zoomControl.setPosition("bottomright"),e.map.addLayer(e.cluster),e.resetCluster=function(){e.map.removeLayer(e.cluster),e.cluster=new L.MarkerClusterGroup,e.map.addLayer(e.cluster)}}])}),"use strict",define("controllers/MenuController",["./module"],function(e){e.controller("MenuController",["$scope",function(e){e.menu={activeTab:{title:"artist",param:"artist"},searchValue:"",activeTag:"",festivalsOnly:0},e.tabs=[{title:"artist",param:"artist"},{title:"location",param:"geo"}],e.switchTab=function(t){e.menu.activeTab=t,e.menu.searchValue=""},e.tags=["rock","pop","alternative","indie","electronic","classic rock","hip-hop","dance","jazz"],e.switchTag=function(t){e.menu.activeTag=e.menu.activeTag==t?"":t},e.setFestivalsOnly=function(){e.menu.festivalsOnly=e.menu.festivalsOnly==0?1:0}}])}),"use strict",define("controllers/SearchController",["./module"],function(e){e.controller("SearchController",["$scope","SearchService",function(e,t){e.events=[],e.lastEvents=[],e.pages={page:0,total:1,totalPages:1},e.pages_orig=angular.copy(e.pages),e.search=function(t){e.reset(),e.menu.searchValue=t,e.nextPage()},e.nextPage=function(){e.pages.page<e.pages.totalPages&&e.menu.searchValue&&(e.pages.page++,t.search({param:e.menu.activeTab.param,location:e.menu.searchValue,artist:e.menu.searchValue,festivalsOnly:e.menu.festivalsOnly,tag:e.menu.activeTag,page:e.pages.page}).success(function(t){if(t.error==8||typeof t.events=="undefined"||t.events.total==0)return!1;e.getEvents(t)}))},e.getEvents=function(t){e.pages.totalPages=t.events["@attr"].totalPages,e.pages.total=t.events["@attr"].total,e.lastEvents=t.events.event},e.reset=function(){e.$broadcast("resetPaths"),e.events=[],e.lastEvents=[],e.pages=angular.copy(e.pages_orig),e.$broadcast("resetAutocomplete")}}])}),"use strict",define("controllers/index",["./AutocompleteController","./EventController","./MapController","./MenuController","./SearchController"],function(){}),"use strict",define("services/module",["angular"],function(e){return e.module("ontour.services",[])}),"use strict",define("services/AutocompleteService",["./module"],function(e){e.factory("AutocompleteService",["$http",function(e){function t(t){return e({method:"GET",url:"http://ws.audioscrobbler.com/2.0/",params:{method:"artist.search",artist:t,limit:5,api_key:"dd349d2176d3b97b8162bb0c0e583b1c",format:"json"}})}function n(t){return e.jsonp("http://gd.geobytes.com/AutoCompleteCity?callback=JSON_CALLBACK&q="+t)}return{getArtistsData:t,getCitiesData:n}}])}),"use strict",define("services/SearchService",["./module"],function(e){e.factory("SearchService",["$http",function(e){function t(t){return e({url:"http://ws.audioscrobbler.com/2.0/",method:"GET",params:{method:t.param+".getevents",location:t.location,artist:t.artist,autocorrect:1,festivalsonly:t.festivalsOnly,tag:t.tag,page:t.page,limit:10,api_key:"dd349d2176d3b97b8162bb0c0e583b1c",format:"json"}})}return{search:t}}])}),"use strict",define("services/index",["./AutocompleteService","./SearchService"],function(){}),"use strict",define("App",["angular","animate","./controllers/index","./services/index"],function(e,t){return e.module("App",["ngAnimate","ontour.controllers","ontour.services"])}),"use strict",require.config({shim:{angular:{exports:"angular"},animate:{deps:["angular"],exports:"animate"},cluster:{deps:["mapbox"]}},paths:{angular:"https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0-beta.13/angular",mapbox:"https://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox",cluster:"https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster",animate:"vendor/angular-animate.min"}}),require(["App"],function(e){angular.bootstrap(document,["App"])}),define("main",function(){});